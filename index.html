<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nederlandse Vacature Optimizer - TalentFlow Pro MVP</title>
    <meta name="description" content="Optimaliseer je vacatures voor de Nederlandse arbeidsmarkt met AI. Verhoog je respons met 40-60% door slimme analyse en verbeterpunten.">
    <meta name="keywords" content="vacature optimalisatie, Nederlandse recruitment, AI recruitment tool, vacature verbeteren">
    
    <!-- Preload TypeForm resources for faster loading -->
    <link rel="preconnect" href="https://embed.typeform.com">
    <link rel="dns-prefetch" href="//embed.typeform.com">
    <link rel="preload" href="//embed.typeform.com/next/embed.js" as="script">
    
    <!-- Favicon & PWA -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E🇳🇱%3C/text%3E%3C/svg%3E">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FF6B35">
    
    <!-- SEO & Social -->
    <meta property="og:title" content="Nederlandse Vacature Optimizer - AI-Powered Recruitment">
    <meta property="og:description" content="Optimaliseer je vacatures voor de Nederlandse arbeidsmarkt. Verhoog response rates met 89% door AI-powered analyse.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://nederlandse-vacature-optimizer.netlify.app">
    <meta property="og:image" content="https://nederlandse-vacature-optimizer.netlify.app/assets/og-image.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Nederlandse Vacature Optimizer">
    <meta name="twitter:description" content="AI-powered vacature optimalisatie voor Nederlandse recruitment">
    <meta name="twitter:image" content="https://nederlandse-vacature-optimizer.netlify.app/assets/twitter-card.png">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS - Inline to avoid loading issues -->
    <style>
/* ===============================================
   Nederlandse Vacature Optimizer - CSS Styles
   TalentFlow Pro MVP - Professional Design System
   =============================================== */

/* CSS Variables - Brand Colors & Design Tokens */
:root {
  /* Brand Colors - Nederlandse Recruitment Theme */
  --primary-orange: #FF6B35;
  --primary-blue: #1E3A8A;
  --accent-green: #10B981;
  --accent-yellow: #F59E0B;
  
  /* Semantic Colors */
  --success: #22C55E;
  --warning: #F59E0B;
  --error: #EF4444;
  --info: #3B82F6;
  
  /* Neutral Palette */
  --white: #FFFFFF;
  --gray-50: #F9FAFB;
  --gray-100: #F3F4F6;
  --gray-200: #E5E7EB;
  --gray-300: #D1D5DB;
  --gray-400: #9CA3AF;
  --gray-500: #6B7280;
  --gray-600: #4B5563;
  --gray-700: #374151;
  --gray-800: #1F2937;
  --gray-900: #111827;
  
  /* Typography */
  --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', roboto, sans-serif;
  --font-heading: 'Poppins', 'Inter', sans-serif;
  
  /* Spacing System */
  --space-xs: 0.25rem;
  --space-sm: 0.5rem;
  --space-md: 1rem;
  --space-lg: 1.5rem;
  --space-xl: 2rem;
  --space-2xl: 3rem;
  --space-3xl: 4rem;
  
  /* Border Radius */
  --radius-sm: 0.375rem;
  --radius-md: 0.5rem;
  --radius-lg: 0.75rem;
  --radius-xl: 1rem;
  --radius-2xl: 1.5rem;
  
  /* Shadows */
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  
  /* Transitions */
  --transition-fast: 0.15s ease-out;
  --transition-normal: 0.3s ease-out;
  --transition-slow: 0.5s ease-out;
}

/* Reset & Base Styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
  font-size: 16px;
}

body {
  font-family: var(--font-primary);
  line-height: 1.6;
  color: var(--gray-800);
  background: linear-gradient(135deg, var(--gray-50) 0%, #E0E7FF 100%);
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Container */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 var(--space-lg);
}

/* ===============================================
   LOADING SCREEN
   =============================================== */

.loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-orange) 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  animation: fadeOut 0.5s ease-out 2s forwards;
}

.loading-content {
  text-align: center;
  color: var(--white);
}

.loading-logo {
  font-size: 4rem;
  margin-bottom: var(--space-lg);
  animation: bounce 1s infinite;
}

.loading-text {
  font-size: 1.25rem;
  font-weight: 500;
  margin-bottom: var(--space-xl);
}

.loading-bar {
  width: 200px;
  height: 4px;
  background: rgba(255, 255, 255, 0.3);
  border-radius: var(--radius-sm);
  overflow: hidden;
}

.loading-progress {
  height: 100%;
  background: var(--white);
  border-radius: var(--radius-sm);
  animation: loadingProgress 2s ease-out forwards;
}

@keyframes fadeOut {
  to {
    opacity: 0;
    visibility: hidden;
  }
}

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    transform: translateY(0);
  }
  40% {
    transform: translateY(-10px);
  }
  60% {
    transform: translateY(-5px);
  }
}

@keyframes loadingProgress {
  from {
    width: 0%;
  }
  to {
    width: 100%;
  }
}

/* ===============================================
   HERO SECTION
   =============================================== */

.hero-section {
  position: relative;
  background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-orange) 100%);
  color: var(--white);
  padding: var(--space-3xl) 0;
  text-align: center;
  overflow: hidden;
}

.hero-content {
  position: relative;
  z-index: 2;
  max-width: 800px;
  margin: 0 auto;
  padding: 0 var(--space-lg);
}

.hero-badge {
  display: inline-flex;
  align-items: center;
  background: rgba(255, 255, 255, 0.2);
  padding: var(--space-sm) var(--space-lg);
  border-radius: var(--radius-2xl);
  margin-bottom: var(--space-xl);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.badge-text {
  font-size: 0.875rem;
  font-weight: 500;
  margin-right: var(--space-sm);
}

.badge-highlight {
  font-weight: 600;
  color: var(--accent-yellow);
}

.hero-title {
  font-family: var(--font-heading);
  font-size: clamp(2.5rem, 5vw, 4rem);
  font-weight: 700;
  line-height: 1.1;
  margin-bottom: var(--space-lg);
}

.title-main {
  display: block;
}

.title-highlight {
  display: block;
  color: var(--accent-yellow);
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.hero-subtitle {
  font-size: 1.25rem;
  line-height: 1.6;
  margin-bottom: var(--space-2xl);
  opacity: 0.9;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}

.hero-stats {
  display: flex;
  justify-content: center;
  gap: var(--space-2xl);
  margin-top: var(--space-2xl);
}

.stat-item {
  text-align: center;
}

.stat-number {
  font-family: var(--font-heading);
  font-size: 2rem;
  font-weight: 700;
  color: var(--accent-yellow);
  display: block;
}

.stat-label {
  font-size: 0.875rem;
  opacity: 0.8;
  margin-top: var(--space-xs);
}

/* Hero Background Animation */
.hero-background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  z-index: 1;
}

.floating-element {
  position: absolute;
  font-size: 2rem;
  opacity: 0.1;
  animation: float var(--duration, 6s) ease-in-out infinite;
  animation-delay: var(--delay, 0s);
}

.floating-element:nth-child(1) { top: 20%; left: 10%; }
.floating-element:nth-child(2) { top: 60%; right: 15%; }
.floating-element:nth-child(3) { bottom: 30%; left: 20%; }
.floating-element:nth-child(4) { top: 40%; right: 25%; }

@keyframes float {
  0%, 100% {
    transform: translateY(0px) rotate(0deg);
  }
  25% {
    transform: translateY(-20px) rotate(90deg);
  }
  50% {
    transform: translateY(-40px) rotate(180deg);
  }
  75% {
    transform: translateY(-20px) rotate(270deg);
  }
}

/* ===============================================
   DEMO SECTION
   =============================================== */

.demo-section {
  padding: var(--space-2xl) 0;
  background: var(--white);
  border-bottom: 1px solid var(--gray-200);
}

.demo-title {
  font-family: var(--font-heading);
  font-size: 1.5rem;
  font-weight: 600;
  text-align: center;
  margin-bottom: var(--space-xl);
  color: var(--gray-800);
}

.demo-buttons {
  display: flex;
  justify-content: center;
  gap: var(--space-lg);
  flex-wrap: wrap;
}

.demo-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: var(--space-lg);
  border: 2px solid transparent;
  border-radius: var(--radius-xl);
  background: var(--gray-50);
  cursor: pointer;
  transition: all var(--transition-normal);
  min-width: 180px;
  text-align: center;
}

.demo-btn:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-lg);
}

.demo-btn-bad {
  border-color: var(--error);
}

.demo-btn-bad:hover {
  background: #FEF2F2;
  border-color: var(--error);
}

.demo-btn-average {
  border-color: var(--warning);
}

.demo-btn-average:hover {
  background: #FFFBEB;
  border-color: var(--warning);
}

.demo-btn-good {
  border-color: var(--success);
}

.demo-btn-good:hover {
  background: #F0FDF4;
  border-color: var(--success);
}

.demo-icon {
  font-size: 2rem;
  margin-bottom: var(--space-sm);
}

.demo-text {
  font-weight: 600;
  color: var(--gray-800);
  margin-bottom: var(--space-xs);
}

.demo-score {
  font-size: 0.875rem;
  color: var(--gray-600);
}

/* ===============================================
   OPTIMIZER TOOL
   =============================================== */

.optimizer-tool {
  padding: var(--space-3xl) 0;
  background: var(--white);
}

.tool-header {
  text-align: center;
  margin-bottom: var(--space-2xl);
}

.tool-title {
  font-family: var(--font-heading);
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--gray-900);
  margin-bottom: var(--space-lg);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-md);
}

.tool-icon {
  font-size: 2rem;
}

.tool-subtitle {
  font-size: 1.125rem;
  color: var(--gray-600);
  max-width: 600px;
  margin: 0 auto;
  line-height: 1.6;
}

.input-section {
  max-width: 800px;
  margin: 0 auto;
}

.input-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-lg);
  flex-wrap: wrap;
  gap: var(--space-md);
}

.input-label {
  font-weight: 600;
  color: var(--gray-800);
  font-size: 1.125rem;
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.input-counter {
  font-size: 0.875rem;
  color: var(--gray-500);
  font-weight: 400;
}

.input-actions {
  display: flex;
  gap: var(--space-sm);
}

.action-btn {
  padding: var(--space-sm) var(--space-md);
  border: 1px solid var(--gray-300);
  border-radius: var(--radius-md);
  background: var(--white);
  color: var(--gray-700);
  font-size: 0.875rem;
  cursor: pointer;
  transition: all var(--transition-fast);
}

.action-btn:hover {
  background: var(--gray-50);
  border-color: var(--gray-400);
}

.action-btn-clear:hover {
  background: #FEF2F2;
  border-color: var(--error);
  color: var(--error);
}

.action-btn-paste:hover {
  background: #EFF6FF;
  border-color: var(--info);
  color: var(--info);
}

.textarea-container {
  background: var(--white);
  border: 2px solid var(--gray-200);
  border-radius: var(--radius-lg);
  overflow: hidden;
  transition: border-color var(--transition-fast);
  box-shadow: var(--shadow-sm);
}

.textarea-container:focus-within {
  border-color: var(--primary-orange);
  box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
}

.vacature-textarea {
  width: 100%;
  height: 400px;
  padding: var(--space-lg);
  border: none;
  font-family: var(--font-primary);
  font-size: 1rem;
  line-height: 1.6;
  resize: vertical;
  background: transparent;
  color: var(--gray-800);
}

.vacature-textarea:focus {
  outline: none;
}

.vacature-textarea::placeholder {
  color: var(--gray-400);
  line-height: 1.8;
}

.textarea-footer {
  background: var(--gray-50);
  border-top: 1px solid var(--gray-200);
  padding: var(--space-md) var(--space-lg);
}

.quality-indicators {
  display: flex;
  gap: var(--space-lg);
  flex-wrap: wrap;
}

.quality-indicator {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  font-size: 0.875rem;
  color: var(--gray-600);
}

.indicator-icon {
  font-size: 1rem;
}

.status-poor { color: var(--error); }
.status-fair { color: var(--warning); }
.status-good { color: var(--success); }
.status-excellent { color: var(--accent-green); }

.analyze-btn {
  width: 100%;
  margin-top: var(--space-xl);
  padding: var(--space-lg) var(--space-xl);
  background: linear-gradient(135deg, var(--primary-orange), #F97316);
  color: var(--white);
  border: none;
  border-radius: var(--radius-xl);
  font-size: 1.125rem;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition-normal);
  box-shadow: var(--shadow-md);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-md);
  min-height: 60px;
}

.analyze-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
  background: linear-gradient(135deg, #EA580C, var(--primary-orange));
}

.analyze-btn:disabled {
  opacity: 0.7;
  cursor: not-allowed;
  transform: none;
}

.btn-icon {
  font-size: 1.5rem;
}

.btn-text {
  font-size: 1.125rem;
}

.btn-subtitle {
  font-size: 0.875rem;
  opacity: 0.9;
  margin-left: var(--space-sm);
}

/* ===============================================
   RESULTS SECTION
   =============================================== */

.results-section {
  margin-top: var(--space-3xl);
  padding-top: var(--space-2xl);
  border-top: 2px solid var(--gray-200);
}

.results-header {
  text-align: center;
  margin-bottom: var(--space-2xl);
}

.results-title {
  font-family: var(--font-heading);
  font-size: 2rem;
  font-weight: 700;
  color: var(--gray-900);
  margin-bottom: var(--space-md);
}

.results-subtitle {
  font-size: 1.125rem;
  color: var(--gray-600);
}

.scores-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(2, auto);
  gap: var(--space-lg);
  margin: var(--space-2xl) 0;
  max-width: 1000px;
  margin-left: auto;
  margin-right: auto;
}

.score-card {
  background: var(--white);
  padding: var(--space-xl);
  border-radius: var(--radius-xl);
  text-align: center;
  border: 2px solid var(--gray-200);
  transition: all var(--transition-normal);
  box-shadow: var(--shadow-sm);
}

.score-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-lg);
}

.score-number {
  font-family: var(--font-heading);
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: var(--space-sm);
  display: block;
}

.score-low { color: var(--error); }
.score-medium { color: var(--warning); }
.score-high { color: var(--success); }

.score-label {
  font-size: 1rem;
  color: var(--gray-700);
  font-weight: 600;
  margin-bottom: var(--space-sm);
}

.score-description {
  font-size: 0.875rem;
  color: var(--gray-600);
  line-height: 1.5;
}

.average-score-card {
  border-color: var(--primary-orange) !important;
  background: linear-gradient(135deg, #FFF7ED, var(--white));
}

.average-score-card .score-number {
  color: var(--primary-orange) !important;
}

.analysis-section {
  background: var(--gray-50);
  border: 1px solid var(--gray-200);
  border-radius: var(--radius-xl);
  padding: var(--space-2xl);
  margin: var(--space-2xl) 0;
}

.analysis-title {
  font-family: var(--font-heading);
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--gray-900);
  margin-bottom: var(--space-lg);
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.improvement-list {
  list-style: none;
  padding: 0;
}

.improvement-item {
  background: var(--white);
  padding: var(--space-lg);
  margin: var(--space-md) 0;
  border-radius: var(--radius-lg);
  border-left: 4px solid var(--primary-orange);
  box-shadow: var(--shadow-sm);
  transition: all var(--transition-fast);
}

.improvement-item:hover {
  transform: translateX(4px);
  box-shadow: var(--shadow-md);
}

.improvement-number {
  font-weight: 700;
  color: var(--primary-orange);
  margin-right: var(--space-sm);
}

.market-analysis {
  background: #FFF7ED;
  border: 1px solid #FDBA74;
  border-radius: var(--radius-lg);
  padding: var(--space-lg);
  margin: var(--space-lg) 0;
}

.market-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: var(--space-lg);
  margin-top: var(--space-lg);
}

.market-item {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
}

.market-label {
  font-weight: 600;
  color: var(--gray-700);
}

.market-value {
  color: var(--gray-900);
  font-size: 1.125rem;
}

.optimized-section {
  background: #F0FDF4;
  border: 1px solid #BBF7D0;
  border-radius: var(--radius-xl);
  padding: var(--space-2xl);
  margin: var(--space-2xl) 0;
}

.optimized-text {
  background: var(--white);
  padding: var(--space-xl);
  border-radius: var(--radius-lg);
  white-space: pre-wrap;
  line-height: 1.8;
  font-size: 1rem;
  border: 1px solid #BBF7D0;
  color: var(--gray-800);
  font-family: var(--font-primary);
}

.copy-btn {
  background: var(--success);
  color: var(--white);
  padding: var(--space-md) var(--space-xl);
  border: none;
  border-radius: var(--radius-lg);
  font-weight: 600;
  cursor: pointer;
  margin-top: var(--space-lg);
  transition: all var(--transition-fast);
  display: inline-flex;
  align-items: center;
  gap: var(--space-sm);
  margin-right: var(--space-md);
}

.copy-btn:hover {
  background: #16A34A;
  transform: translateY(-1px);
}

/* Loading States */
.spinner {
  border: 3px solid var(--gray-200);
  border-top: 3px solid var(--primary-orange);
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 0 auto var(--space-lg);
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Error States */
.error-section {
  background: #FEF2F2;
  border: 1px solid #FECACA;
  border-radius: var(--radius-xl);
  padding: var(--space-2xl);
  color: #991B1B;
  text-align: center;
}

.error-title {
  font-size: 1.5rem;
  font-weight: 600;
  margin-bottom: var(--space-lg);
}

.error-message {
  margin-bottom: var(--space-lg);
}

.retry-btn {
  background: var(--error);
  color: var(--white);
  padding: var(--space-md) var(--space-xl);
  border: none;
  border-radius: var(--radius-lg);
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition-fast);
}

.retry-btn:hover {
  background: #DC2626;
}

/* ===============================================
   UPGRADE SECTION & TYPEFORM
   =============================================== */

.upgrade-section {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 3rem 2rem;
  margin: 2rem 0;
  border-radius: 1rem;
  text-align: center;
}

.upgrade-content {
  max-width: 600px;
  margin: 0 auto;
}

.upgrade-title {
  font-size: 2rem;
  font-weight: 600;
  margin-bottom: 1rem;
}

.upgrade-description {
  font-size: 1.1rem;
  margin-bottom: 2rem;
  opacity: 0.95;
  line-height: 1.6;
}

.upgrade-btn {
  background: #FF6B35;
  color: white;
  border: none;
  padding: 1rem 2rem;
  border-radius: 0.5rem;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
  text-decoration: none;
}

.upgrade-btn:hover {
  background: #e55a2b;
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
}

.upgrade-btn:disabled {
  opacity: 0.7;
  cursor: not-allowed;
  transform: none;
}

.typeform-container {
  margin-top: 2rem;
  padding: 2rem;
  background: white;
  border-radius: 1rem;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.typeform-loading {
  text-align: center;
  padding: 3rem 2rem;
}

.typeform-spinner {
  width: 50px;
  height: 50px;
  border: 4px solid #f3f4f6;
  border-top: 4px solid #FF6B35;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 1rem;
}

.typeform-loading h4 {
  color: #1f2937;
  margin-bottom: 0.5rem;
}

.typeform-loading p {
  color: #6b7280;
}

#typeformEmbed [data-tf-live] {
  width: 100%;
  min-height: 500px;
}

/* ===============================================
   FEATURES SECTION
   =============================================== */

.features-section {
  padding: var(--space-3xl) 0;
  background: var(--gray-50);
}

.features-title {
  font-family: var(--font-heading);
  font-size: 2rem;
  font-weight: 700;
  text-align: center;
  color: var(--gray-900);
  margin-bottom: var(--space-2xl);
}

.features-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: var(--space-xl);
}

.feature-card {
  background: var(--white);
  padding: var(--space-2xl);
  border-radius: var(--radius-xl);
  text-align: center;
  box-shadow: var(--shadow-sm);
  transition: all var(--transition-normal);
  border: 1px solid var(--gray-200);
}

.feature-card:hover {
  transform: translateY(-8px);
  box-shadow: var(--shadow-xl);
}

.feature-icon {
  font-size: 3rem;
  margin-bottom: var(--space-lg);
  display: block;
}

.feature-title {
  font-family: var(--font-heading);
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--gray-900);
  margin-bottom: var(--space-md);
}

.feature-description {
  color: var(--gray-600);
  line-height: 1.6;
}

/* ===============================================
   PROCESS SECTION
   =============================================== */

.process-section {
  padding: var(--space-3xl) 0;
  background: var(--white);
}

.process-title {
  font-family: var(--font-heading);
  font-size: 2rem;
  font-weight: 700;
  text-align: center;
  color: var(--gray-900);
  margin-bottom: var(--space-2xl);
}

.process-steps {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-xl);
  flex-wrap: wrap;
  max-width: 1000px;
  margin: 0 auto;
}

.process-step {
  flex: 1;
  min-width: 200px;
  text-align: center;
}

.step-number {
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, var(--primary-orange), #F97316);
  color: var(--white);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  font-weight: 700;
  margin: 0 auto var(--space-lg);
  box-shadow: var(--shadow-md);
}

.step-title {
  font-family: var(--font-heading);
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--gray-900);
  margin-bottom: var(--space-sm);
}

.step-description {
  color: var(--gray-600);
  line-height: 1.6;
  font-size: 0.9rem;
}

.process-arrow {
  font-size: 1.5rem;
  color: var(--primary-orange);
  flex-shrink: 0;
}

/* ===============================================
   FOOTER
   =============================================== */

.footer-section {
  background: var(--gray-900);
  color: var(--gray-300);
  padding: var(--space-2xl) 0 var(--space-lg);
}

.footer-content {
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: var(--space-2xl);
  margin-bottom: var(--space-2xl);
}

.footer-logo {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-lg);
}

.logo-icon {
  font-size: 2rem;
}

.logo-text {
  font-family: var(--font-heading);
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--white);
}

.footer-description {
  line-height: 1.6;
  color: var(--gray-400);
}

.footer-links {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--space-xl);
}

.footer-title {
  font-weight: 600;
  color: var(--white);
  margin-bottom: var(--space-md);
}

.footer-list {
  list-style: none;
}

.footer-list li {
  margin-bottom: var(--space-sm);
}

.footer-list a {
  color: var(--gray-400);
  text-decoration: none;
  transition: color var(--transition-fast);
}

.footer-list a:hover {
  color: var(--primary-orange);
}

.footer-bottom {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: var(--space-lg);
  border-top: 1px solid var(--gray-700);
}

.footer-credit {
  color: var(--gray-500);
  font-size: 0.875rem;
}

.footer-social {
  display: flex;
  gap: var(--space-md);
}

.social-link {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  background: var(--gray-800);
  border-radius: 50%;
  text-decoration: none;
  font-size: 1.25rem;
  transition: all var(--transition-fast);
}

.social-link:hover {
  background: var(--primary-orange);
  transform: translateY(-2px);
}

/* ===============================================
   TOAST NOTIFICATIONS
   =============================================== */

.toast-container {
  position: fixed;
  top: var(--space-lg);
  right: var(--space-lg);
  z-index: 1000;
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
}

.toast {
  background: var(--white);
  border-radius: var(--radius-lg);
  padding: var(--space-lg);
  box-shadow: var(--shadow-xl);
  border-left: 4px solid var(--primary-orange);
  max-width: 400px;
  animation: slideInRight 0.3s ease-out;
}

.toast-success {
  border-left-color: var(--success);
}

.toast-error {
  border-left-color: var(--error);
}

.toast-warning {
  border-left-color: var(--warning);
}

.toast-title {
  font-weight: 600;
  margin-bottom: var(--space-xs);
}

.toast-message {
  font-size: 0.875rem;
  color: var(--gray-600);
}

@keyframes slideInRight {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes slideOutRight {
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(100%);
    opacity: 0;
  }
}

/* ===============================================
   RESPONSIVE DESIGN
   =============================================== */

@media (max-width: 768px) {
  .container {
    padding: 0 var(--space-md);
  }
  
  .hero-section {
    padding: var(--space-2xl) 0;
  }
  
  .hero-title {
    font-size: 2.5rem;
  }
  
  .hero-stats {
    flex-direction: column;
    gap: var(--space-lg);
  }
  
  .demo-buttons {
    flex-direction: column;
    align-items: center;
  }
  
  .demo-btn {
    width: 100%;
    max-width: 300px;
  }
  
  .tool-title {
    font-size: 2rem;
    flex-direction: column;
    gap: var(--space-sm);
  }
  
  .input-header {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .scores-grid {
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(3, auto);
    gap: var(--space-md);
  }
  
  .market-grid {
    grid-template-columns: 1fr;
  }
  
  .process-steps {
    flex-direction: column;
  }
  
  .process-arrow {
    transform: rotate(90deg);
  }
  
  .footer-content {
    grid-template-columns: 1fr;
  }
  
  .footer-links {
    grid-template-columns: 1fr;
    gap: var(--space-lg);
  }
  
  .footer-bottom {
    flex-direction: column;
    gap: var(--space-lg);
    text-align: center;
  }
  
  .toast-container {
    left: var(--space-md);
    right: var(--space-md);
  }
  
  .toast {
    max-width: none;
  }
  
  .upgrade-btn {
    flex-direction: column;
    text-align: center;
  }
  
  .upgrade-title {
    font-size: 1.5rem;
  }
}

@media (max-width: 480px) {
  .hero-title {
    font-size: 2rem;
  }
  
  .hero-subtitle {
    font-size: 1rem;
  }
  
  .vacature-textarea {
    height: 300px;
  }
  
  .quality-indicators {
    flex-direction: column;
    gap: var(--space-sm);
  }
  
  .features-grid {
    grid-template-columns: 1fr;
  }
  
  .scores-grid {
    grid-template-columns: 1fr;
    grid-template-rows: repeat(6, auto);
    gap: var(--space-sm);
  }
  
  .feature-card {
    padding: var(--space-lg);
  }
}

/* ===============================================
   ACCESSIBILITY
   =============================================== */

@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
  
  .floating-element {
    animation: none;
  }
  
  .loading-progress {
    animation: none;
    width: 100%;
  }
  
  .spinner {
    animation: none;
    border-top-color: var(--primary-orange);
  }
}

button:focus-visible,
textarea:focus-visible,
a:focus-visible {
  outline: 2px solid var(--primary-orange);
  outline-offset: 2px;
}

/* Screen reader only content */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  :root {
    --gray-200: #000000;
    --gray-300: #000000;
    --gray-600: #000000;
  }
  
  .demo-btn,
  .feature-card,
  .score-card {
    border-width: 2px;
  }
}
    </style>
    
    <!-- Google Analytics (Environmental) -->
    <script>
      if(typeof GA_MEASUREMENT_ID !== 'undefined' && GA_MEASUREMENT_ID) {
        const script = document.createElement('script');
        script.async = true;
        script.src = `https://www.googletagmanager.com/gtag/js?id=${GA_MEASUREMENT_ID}`;
        document.head.appendChild(script);
        
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', GA_MEASUREMENT_ID);
      }
    </script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">🇳🇱</div>
            <div class="loading-text">TalentFlow Pro wordt geladen...</div>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app" class="app-container" style="display: none;">
        <!-- Header -->
        <header class="hero-section">
            <div class="hero-content">
                <div class="hero-badge">
                    <span class="badge-text">🚀 AI-Powered</span>
                    <span class="badge-highlight">Nederlandse Recruitment</span>
                </div>
                
                <h1 class="hero-title">
                    <span class="title-main">Nederlandse Vacature</span>
                    <span class="title-highlight">Optimizer</span>
                </h1>
                
                <p class="hero-subtitle">
                    Verhoog je sollicitaties met <strong>40-60%</strong> door AI-powered optimalisatie 
                    voor de Nederlandse arbeidsmarkt
                </p>
                
                <div class="hero-stats">
                    <div class="stat-item">
                        <div class="stat-number">180%</div>
                        <div class="stat-label">Meer Sollicitaties</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">2 min</div>
                        <div class="stat-label">Analyse Tijd</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">95%</div>
                        <div class="stat-label">Tevredenheid</div>
                    </div>
                </div>
            </div>
            
            <!-- Hero Background Animation -->
            <div class="hero-background">
                <div class="floating-element" style="--delay: 0s; --duration: 6s;">💼</div>
                <div class="floating-element" style="--delay: 1s; --duration: 8s;">📊</div>
                <div class="floating-element" style="--delay: 2s; --duration: 7s;">🎯</div>
                <div class="floating-element" style="--delay: 3s; --duration: 9s;">⚡</div>
            </div>
        </header>

        <!-- Demo Buttons Section -->
        <section class="demo-section">
            <div class="container">
                <h3 class="demo-title">🎮 Probeer Direct met Demo Vacature</h3>
                <div class="demo-buttons">
                    <button onclick="loadDemoVacature('goed')" class="demo-btn demo-btn-good">
                        <span class="demo-icon">📈</span>
                        <span class="demo-text">Demo Vacature</span>
                        <span class="demo-score">Voorbeeld Analyse</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- Main Tool Section -->
        <main class="optimizer-tool">
            <div class="container">
                <div class="tool-header">
                    <h2 class="tool-title">
                        <span class="tool-icon">🔍</span>
                        Analyseer je Vacaturetekst
                    </h2>
                    <p class="tool-subtitle">
                        Plak je volledige vacature hieronder en ontvang binnen 60 seconden 
                        een complete analyse met concrete verbeterpunten
                    </p>
                </div>

                <div class="input-section">
                    <div class="input-header">
                        <label for="vacatureInput" class="input-label">
                            📝 Vacaturetekst
                            <span class="input-counter">
                                <span id="charCount">0</span> / 8000 karakters
                            </span>
                        </label>
                        
                        <div class="input-actions">
                            <button onclick="clearInput()" class="action-btn action-btn-clear">
                                🗑️ Wissen
                            </button>
                            <button onclick="pasteFromClipboard()" class="action-btn action-btn-paste">
                                📋 Plakken
                            </button>
                        </div>
                    </div>
                    
                    <div class="textarea-container">
                        <textarea 
                            id="vacatureInput" 
                            class="vacature-textarea"
                            placeholder="Plak hier je volledige vacaturetekst...

Bijvoorbeeld:
Senior Developer bij TechStart BV

Wij zoeken een ervaren developer voor ons groeiende team...

📍 Tip: Inclusief functietitel, taken, eisen, salaris en contactgegevens voor beste resultaten!"
                            maxlength="8000"
                            oninput="updateCharCounter()"
                        ></textarea>
                        
                        <div class="textarea-footer">
                            <div class="quality-indicators">
                                <div class="quality-indicator" id="lengthIndicator">
                                    <span class="indicator-icon">📏</span>
                                    <span class="indicator-text">Lengte: Te kort</span>
                                </div>
                                <div class="quality-indicator" id="structureIndicator">
                                    <span class="indicator-icon">🏗️</span>
                                    <span class="indicator-text">Structuur: Controleren...</span>
                                </div>
                                <div class="quality-indicator" id="keywordIndicator">
                                    <span class="indicator-icon">🔑</span>
                                    <span class="indicator-text">Keywords: Analyseren...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button id="analyzeBtn" onclick="analyzeVacature()" class="analyze-btn">
                        <span class="btn-icon">🚀</span>
                        <span class="btn-text">Analyseer Vacature</span>
                        <span class="btn-subtitle">AI-powered Nederlandse analyse</span>
                    </button>
                </div>

                <!-- Results Section -->
                <div id="results" class="results-section" style="display: none;">
                    <!-- Results worden hier dynamisch ingeladen -->
                </div>

                <!-- TypeForm Upgrade Section - Only shows after analysis -->
                <div id="upgradeSection" class="upgrade-section" style="display: none;">
                    <div class="upgrade-content">
                        <h3 class="upgrade-title">🚀 Professionele Vacature Service</h3>
                        <p class="upgrade-description">
                            Upload je huidige vacature document en ontvang binnen 24 uur een volledig 
                            professioneel geoptimaliseerde versie met Nederlandse markt best practices en 
                            employer branding advies.
                        </p>
                        
                        <!-- Upload Integration with Privacy -->
                        <div id="typeformContainer" style="margin-top: 2rem;">
                            <!-- Privacy Acceptance Checkbox -->
                            <div style="margin-bottom: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 0.5rem; border: 1px solid #e9ecef;">
                                <label style="display: flex; align-items: flex-start; cursor: pointer; font-size: 0.9rem; line-height: 1.4;">
                                    <input type="checkbox" id="privacyAcceptance" style="margin-right: 0.8rem; margin-top: 0.2rem; transform: scale(1.2);" required>
                                    <span style="color: #495057;">
                                        Ik ga akkoord met de 
                                        <a href="https://recruitin.nl/privacyverklaring-recruitin/" target="_blank" style="color: #FF6B35; text-decoration: none; font-weight: 500;">
                                            privacyverklaring van Recruitin
                                        </a> 
                                        en geef toestemming voor het verwerken van mijn gegevens voor het optimaliseren van de vacaturetekst.
                                        <span style="color: #dc3545; font-weight: 600;">*</span>
                                    </span>
                                </label>
                            </div>
                            
                            <!-- Separate TypeForm Button -->
                            <div id="typeformButtonContainer">
                                <button id="openTypeFormBtn" class="upgrade-btn" onclick="openTypeForm()" disabled style="opacity: 0.5; cursor: not-allowed;">
                                    <span>📄</span>
                                    <span>Upload Document - Open Formulier</span>
                                </button>
                                <p style="font-size: 0.9rem; color: #6b7280; margin-top: 0.5rem; text-align: center;">
                                    Klik hier om het upload formulier te openen
                                </p>
                            </div>
                            
                            <!-- Success Message (shown after TypeForm completion) -->
                            <div id="typeformSuccessMessage" style="display: none; text-align: center; padding: 2rem; background: linear-gradient(135deg, #10b981, #059669); color: white; border-radius: 1rem; margin-top: 1rem;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">🎉</div>
                                <h3 style="margin: 0 0 1rem 0; font-size: 1.5rem;">Formulier Succesvol Verzonden!</h3>
                                <p style="margin: 0 0 2rem 0; opacity: 0.9; line-height: 1.6;">
                                    Bedankt voor je upload! We gaan direct aan de slag met de optimalisatie van je vacature. 
                                    Je ontvangt binnen 24 uur een professioneel geoptimaliseerde versie per email.
                                </p>
                                
                                <!-- Calendly Book Meeting Section -->
                                <div style="background: rgba(255,255,255,0.15); padding: 1.5rem; border-radius: 0.8rem; margin-bottom: 1.5rem;">
                                    <h4 style="margin: 0 0 1rem 0; font-size: 1.1rem;">📅 Plan een Persoonlijk Gesprek</h4>
                                    <p style="margin: 0 0 1.5rem 0; opacity: 0.9; font-size: 0.95rem;">
                                        Wil je persoonlijk sparren over je recruitment strategie? 
                                        Plan een gratis 30-minuten adviesgesprek.
                                    </p>
                                    <a href="https://calendly.com/recruitin/30min" 
                                       target="_blank" 
                                       onclick="trackEvent('calendly_clicked', {event_category: 'conversion', event_label: 'post_typeform'});"
                                       style="display: inline-block; background: white; color: #059669; padding: 1rem 2rem; border-radius: 0.5rem; text-decoration: none; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 10px rgba(0,0,0,0.2);"
                                       onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.3)';"
                                       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 10px rgba(0,0,0,0.2)';">
                                        🚀 Boek Gratis Adviesgesprek
                                    </a>
                                </div>
                                
                                <div style="padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.3);">
                                    <p style="margin: 0; font-size: 0.9rem; opacity: 0.8;">
                                        ✅ Upload voltooid • ✅ Analyse gestart • ✅ Email onderweg
                                    </p>
                                </div>
                            </div>
                        </div>
                            
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Features Section -->
        <section class="features-section">
            <div class="container">
                <h3 class="features-title">⚡ Waarom Nederlandse Vacature Optimizer?</h3>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">🇳🇱</div>
                        <h4 class="feature-title">Nederlandse Expertise</h4>
                        <p class="feature-description">
                            Geoptimaliseerd voor Nederlandse arbeidsmarkt, AVG-compliant, 
                            en afgestemd op lokale recruitment praktijken
                        </p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">⚡</div>
                        <h4 class="feature-title">Razendsnel</h4>
                        <p class="feature-description">
                            Volledige analyse in minder dan 60 seconden. 
                            Bespaar 2+ uur per vacature optimalisatie
                        </p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">🎯</div>
                        <h4 class="feature-title">Concrete Verbeterpunten</h4>
                        <p class="feature-description">
                            Krijg 3-5 specifieke, actionable aanbevelingen 
                            die direct meer sollicitaties opleveren
                        </p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">📊</div>
                        <h4 class="feature-title">Bewezen Resultaten</h4>
                        <p class="feature-description">
                            40-60% meer sollicitaties, 30% snellere invulling, 
                            95% tevredenheidsscore van recruiters
                        </p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">🔒</div>
                        <h4 class="feature-title">Privacy & Veiligheid</h4>
                        <p class="feature-description">
                            Geen opslag van data, AVG-compliant, 
                            enterprise-grade beveiliging
                        </p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">💰</div>
                        <h4 class="feature-title">Gratis te Proberen</h4>
                        <p class="feature-description">
                            Test de tool zonder kosten. 
                            Zie direct de waarde voordat je investeert
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Process Section -->
        <section class="process-section">
            <div class="container">
                <h3 class="process-title">🔄 Hoe het Werkt</h3>
                <div class="process-steps">
                    <div class="process-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4 class="step-title">Plak Vacaturetekst</h4>
                            <p class="step-description">
                                Kopieer je volledige vacature en plak in het tekstveld. 
                                Minimaal 100 woorden voor beste resultaten.
                            </p>
                        </div>
                    </div>
                    
                    <div class="process-arrow">➡️</div>
                    
                    <div class="process-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4 class="step-title">AI Analyse</h4>
                            <p class="step-description">
                                Claude AI analyseert op 10+ criteria: aantrekkelijkheid, 
                                duidelijkheid, salaris transparantie, en meer.
                            </p>
                        </div>
                    </div>
                    
                    <div class="process-arrow">➡️</div>
                    
                    <div class="process-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4 class="step-title">Ontvang Verbeterpunten</h4>
                            <p class="step-description">
                                Krijg een score (1-10), top 3 verbeterpunten, 
                                en een volledig geoptimaliseerde versie.
                            </p>
                        </div>
                    </div>
                    
                    <div class="process-arrow">➡️</div>
                    
                    <div class="process-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4 class="step-title">Implementeer & Meet</h4>
                            <p class="step-description">
                                Kopieer de geoptimaliseerde versie, plaats online, 
                                en zie 40-60% meer sollicitaties.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer-section">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-main">
                        <div class="footer-logo">
                            <span class="logo-icon">🇳🇱</span>
                            <span class="logo-text">TalentFlow Pro</span>
                        </div>
                        <p class="footer-description">
                            Nederlandse Vacature Optimizer - Powered by AI
                            <br>
                            Verhoog je recruitment succes met slimme technologie
                        </p>
                    </div>
                    
                    <div class="footer-links">
                        <div class="footer-column">
                            <h4 class="footer-title">Product</h4>
                            <ul class="footer-list">
                                <li><a href="#features">Features</a></li>
                                <li><a href="#process">Hoe het Werkt</a></li>
                                <li><a href="#demo">Demo</a></li>
                                <li><a href="#pricing">Prijzen</a></li>
                            </ul>
                        </div>
                        
                        <div class="footer-column">
                            <h4 class="footer-title">Support</h4>
                            <ul class="footer-list">
                                <li><a href="#help">Help Center</a></li>
                                <li><a href="#contact">Contact</a></li>
                                <li><a href="#feedback">Feedback</a></li>
                                <li><a href="#status">Status</a></li>
                            </ul>
                        </div>
                        
                        <div class="footer-column">
                            <h4 class="footer-title">Legal</h4>
                            <ul class="footer-list">
                                <li><a href="#privacy">Privacy</a></li>
                                <li><a href="#terms">Voorwaarden</a></li>
                                <li><a href="#security">Beveiliging</a></li>
                                <li><a href="#compliance">AVG</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <div class="footer-credit">
                        <p>
                            © 2025 TalentFlow Pro • Nederlandse Recruitment Innovation
                            <br>
                            <small>Powered by Claude AI • Gebouwd voor Nederlandse Recruitment Professionals</small>
                        </p>
                    </div>
                    
                    <div class="footer-social">
                        <a href="#" class="social-link" title="LinkedIn">💼</a>
                        <a href="#" class="social-link" title="Twitter">🐦</a>
                        <a href="#" class="social-link" title="Email">📧</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- JavaScript - Inline to avoid loading issues -->
    <script>
// ===============================================
// Nederlandse Vacature Optimizer - JavaScript
// TalentFlow Pro MVP - Complete Functionality
// ===============================================

// Preload TypeForm script for faster loading
let typeformScriptLoaded = false;
let typeformScriptLoading = false;

function preloadTypeFormScript() {
    if (typeformScriptLoaded || typeformScriptLoading || document.querySelector('script[src*="embed.typeform.com"]')) {
        return Promise.resolve();
    }
    
    return new Promise((resolve, reject) => {
        typeformScriptLoading = true;
        console.log('🔄 Preloading TypeForm script...');
        
        const script = document.createElement('script');
        script.src = '//embed.typeform.com/next/embed.js';
        script.async = true;
        script.onload = () => {
            console.log('✅ TypeForm script preloaded successfully');
            typeformScriptLoaded = true;
            typeformScriptLoading = false;
            resolve();
        };
        script.onerror = () => {
            console.error('❌ TypeForm script preload failed');
            typeformScriptLoading = false;
            reject();
        };
        document.head.appendChild(script);
    });
}

// Start preloading when page loads
document.addEventListener('DOMContentLoaded', () => {
    // Preload TypeForm script in background
    setTimeout(() => {
        preloadTypeFormScript().catch(() => {
            console.warn('TypeForm preload failed, will try again on demand');
        });
    }, 1000); // Wait 1 second after page load
});

// ===============================================
// BASIC FUNCTIONALITY TEST
// ===============================================
console.log('🧪 JavaScript loading test - START');

// Global Variables - Enhanced with race condition protection
let isAnalyzing = false;
let currentAnalysis = null;
let currentAnalysisPromise = null;
let eventListenersSetup = false;

console.log('🧪 JavaScript loading test - Variables declared successfully');

// ===============================================
// SECURITY FUNCTIONS - XSS Protection
// ===============================================

function sanitizeHTML(str) {
    if (!str) return '';
    
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
}

function safeSetHTML(element, content) {
    if (!element) return;
    
    // For trusted HTML content that needs rendering (like our own generated HTML)
    // we'll use innerHTML but ensure it's our own trusted content
    if (typeof content === 'string' && content.includes('<')) {
        // This is HTML content we generated - should be safe
        element.innerHTML = content;
    } else {
        // This is user or external content - sanitize
        element.textContent = content;
    }
}

function sanitizeVacatureInput(input) {
    if (!input || typeof input !== 'string') return '';
    
    // Remove potential script tags and dangerous content
    let sanitized = input
        .replace(/<script[^>]*>.*?<\/script>/gi, '')
        .replace(/<iframe[^>]*>.*?<\/iframe>/gi, '')
        .replace(/javascript:/gi, '')
        .replace(/on\w+\s*=/gi, '')
        .replace(/data:text\/html/gi, '');
    
    // Remove excessive whitespace but preserve normal formatting
    sanitized = sanitized.replace(/\s{4,}/g, ' ');
    
    // Trim but preserve reasonable length
    return sanitized.trim().substring(0, 8000);
}

// Nederlandse Recruitment Prompt Template
const NEDERLANDS_RECRUITMENT_PROMPT = `
Je bent een senior Nederlandse recruitment expert met 15+ jaar ervaring in tech en industrie.

NEDERLANDSE ARBEIDSMARKT 2025 CONTEXT:
- TTH (Time-to-Hire): 45-60 dagen voor senior rollen
- Salaristransparantie verhoogt respons met 40-60%
- Regionale verschillen: Randstad +10-15% vs Gelderland/Noord-Brabant
- Tech/industrie focus met emphasis op Gelderland markt
- AVG/GDPR compliance is verplicht
- Inclusieve taal verhoogt diversiteit met 25%

ANALYSE CRITERIA (1-10 scores):
1. Aantrekkelijkheid: Employer branding, benefits, ontwikkelingsmogelijkheden, cultuur
2. Duidelijkheid: Functieomschrijving, verwachtingen, doelen, rapportagelijnen
3. Volledigheid: Aanwezigheid essentiële informatie (functie, eisen, salaris, locatie)
4. Salaris_transparantie: Specifieke range of duidelijke indicatie
5. Contact_sollicitatie: Duidelijk proces en toegankelijke contactgegevens

NEDERLANDSE MARKT SPECIFIEKE FACTOREN:
- Werk-privé balans belangrijk voor kandidaten
- Duurzaamheid en maatschappelijke impact wordt gewaardeerd  
- Directe communicatiestijl past bij Nederlandse cultuur
- Hybride werken is standaard geworden
- Ontwikkelingsmogelijkheden zijn cruciaal voor behoud

VACATURE TEKST VOOR ANALYSE:
{VACATURE_TEKST}

Geef analyse in EXACT dit JSON format (geen andere tekst):
{
  "scores": {
    "aantrekkelijkheid": {"score": X, "toelichting": "specifieke feedback waarom deze score"},
    "duidelijkheid": {"score": X, "toelichting": "specifieke feedback waarom deze score"},
    "volledigheid": {"score": X, "toelichting": "specifieke feedback waarom deze score"},
    "salaris_transparantie": {"score": X, "toelichting": "specifieke feedback waarom deze score"},
    "contact_sollicitatie": {"score": X, "toelichting": "specifieke feedback waarom deze score"}
  },
  "gemiddelde_score": X.X,
  "top_3_verbeterpunten": [
    "Concreet verbeterpunt 1 met impact op response rate - specifiek en actionable",
    "Concreet verbeterpunt 2 met impact op TTH - specifiek en actionable", 
    "Concreet verbeterpunt 3 met marktcompetitiviteit - specifiek en actionable"
  ],
  "nederlandse_markt_analyse": {
    "functieniveau": "junior/medior/senior + argumentatie waarom",
    "salaris_inschatting": "€X.XXX-€X.XXX op basis Nederlandse benchmarks voor deze functie",
    "competitiviteit": "zwak/gemiddeld/sterk + waarom ten opzichte van marktstandaard",
    "tth_prognose": "X dagen op basis vacaturekwaliteit en marktomstandigheden",
    "regio_advies": "Gelderland-specifiek advies indien relevant voor de functie"
  },
  "geoptimaliseerde_versie": "Complete verbeterde Nederlandse vacaturetekst die alle feedback implementeert, inclusief functietitel, aantrekkelijke intro, duidelijke taken en eisen, salaris range, benefits, en professionele contactgegevens. Gebruik Nederlandse recruitment best practices."
}
`;

// Demo Vacatures Database
const DEMO_VACATURES = {
    slecht: `Quality Manager

Een uniek hightechproductiebedrijf zoekt een quality manager.

Taken:
- Kwaliteit bewaken
- Processen verbeteren  
- Samenwerken met collega's

Eisen:
- HBO/WO opleiding
- Ervaring in kwaliteit
- Communicatief vaardig

Arbeidsvoorwaarden:
- Goed salaris
- Leuke collega's
- Goede sfeer

Solliciteer via email.`,

    gemiddeld: `Senior Software Developer - React/Node.js

TechStart BV zoekt een ervaren developer voor ons groeiende team.

Wat ga je doen:
• Frontend development met React
• Backend API's bouwen met Node.js
• Samenwerken in Agile team
• Code reviews en mentoring

Wat zoeken we:
• 3+ jaar ervaring React/Node.js
• Kennis van TypeScript
• Ervaring met databases (PostgreSQL)
• HBO/WO niveau

Wat bieden we:
• Competitive salary
• Flexibele werktijden
• Groei mogelijkheden
• Moderne tools

Interesse? Mail naar jobs@techstart.nl`,

    goed: `Senior Quality Manager - Zero Defect Excellence

🎯 Transformeer kwaliteitsprocessen bij innovatief hightech bedrijf op de Veluwe

Als Quality Manager bij ons toonaangevende productiebedrijf leid je de kwaliteitsrevolutie voor internationale medische en aerospace klanten.

Jouw impact:
• Implementeren van zero-defect productieprocessen (ISO 13485, AS9100)
• Leiden van continuous improvement projecten met Lean Six Sigma methodologie
• Strategische advisering aan senior management over kwaliteitsrisico's
• Coaching en ontwikkeling van multidisciplinair kwaliteitsteam (8 professionals)

💼 Wat zoeken we?
• 5+ jaar leidinggevende ervaring Quality Management (hightech/medtech)
• WO Technische Bedrijfskunde + Six Sigma Black Belt certificering
• Aantoonbare ervaring met ISO 9001/13485 en AS9100 implementatie
• Excellent in Nederlands en Engels (stakeholder communicatie)
• Woonachtig in regio Arnhem, Nijmegen, Apeldoorn of omgeving

💰 Wat bieden wij? (€75.000 - €95.000)
• Competitief salaris €75.000-€95.000 + resultaatbonus tot 10%
• 40 vrije dagen (27 vakantie + 13 ADV)
• Hybride werken: 3 dagen kantoor / 2 dagen thuis
• Persoonlijk ontwikkelbudget €3.000/jaar voor certificeringen
• Pensioenregeling met 50% werkgeversbijdrage
• Leaseauto of reiskostenvergoeding €0.19/km
• Internationale carrièremogelijkheden binnen VECO groep

🚀 Jouw groeipad:
Direct rapporterend aan Operations Director met doorgroeimogelijkheden naar:
• Director Quality & Compliance (binnen 2-3 jaar)
• Operations Director functie
• International Quality Lead voor groepsmaatschappijen

📞 Direct solliciteren:
Marlon Vintges, Senior Recruiter
Tel: 06-48772698 (ook WhatsApp)
Email: m.vintges@veco.com

Geïnteresseerd? Solliciteer vandaag - wij reageren binnen 24 uur!

VECO Precision • Veluwe • www.veco.com
Acquisitie naar aanleiding van deze vacature wordt niet gewaardeerd.`
};

// ===============================================
// APP INITIALIZATION
// ===============================================

function initializeApp() {
    console.log('🚀 Nederlandse Vacature Optimizer MVP wordt geïnitialiseerd...');
    console.log('🔍 DOM readyState:', document.readyState);
    
    // Debug: Check if critical elements exist
    const loadingScreen = document.getElementById('loadingScreen');
    const app = document.getElementById('app');
    const textarea = document.getElementById('vacatureInput');
    const analyzeBtn = document.getElementById('analyzeBtn');
    
    console.log('🧩 Found elements:', {
        loadingScreen: loadingScreen ? 'YES' : 'NO',
        app: app ? 'YES' : 'NO', 
        textarea: textarea ? 'YES' : 'NO',
        analyzeBtn: analyzeBtn ? 'YES' : 'NO'
    });
    
    // Hide loading screen after 2 seconds
    setTimeout(() => {
        if (loadingScreen && app) {
            console.log('✅ Hiding loading screen, showing app');
            loadingScreen.style.display = 'none';
            app.style.display = 'block';
            app.style.animation = 'fadeIn 0.5s ease-out';
        } else {
            console.error('❌ Missing critical elements:', { loadingScreen: !!loadingScreen, app: !!app });
        }
    }, 2000);
    
    // Initialize event listeners
    setupEventListeners();
    
    // Initialize privacy checkbox
    initializePrivacyCheckbox();
    
    // Initialize character counter
    updateCharCounter();
    
    // Track page load
    trackEvent('page_load', {
        event_category: 'engagement',
        timestamp: new Date().toISOString()
    });
    
    console.log('✅ App geïnitialiseerd');
}

function setupEventListeners() {
    // Prevent multiple setup
    if (eventListenersSetup) return;
    eventListenersSetup = true;
    
    console.log('🔧 Setting up event listeners...');
    
    // Textarea input events
    const textarea = document.getElementById('vacatureInput');
    if (textarea) {
        console.log('✅ Textarea found, adding listeners');
        textarea.addEventListener('input', updateCharCounter);
        textarea.addEventListener('paste', handlePaste);
    } else {
        console.error('❌ Textarea not found!');
    }
    
    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
        // Cancel any ongoing analysis
        if (currentAnalysisPromise && isAnalyzing) {
            console.log('🛑 Page unload: Cancelling ongoing analysis');
            isAnalyzing = false;
        }
    });
    
    // Button click tracking
    document.addEventListener('click', (e) => {
        if (e.target.matches('.demo-btn')) {
            trackEvent('demo_button_clicked', {
                event_category: 'user_interaction',
                demo_type: e.target.textContent.includes('Slechte') ? 'bad' : 
                          e.target.textContent.includes('Gemiddelde') ? 'average' : 'good'
            });
        }
    });
}

// ===============================================
// DEMO FUNCTIONALITY
// ===============================================

function loadDemoVacature(type) {
    const textarea = document.getElementById('vacatureInput');
    const resultsDiv = document.getElementById('results');
    const upgradeSection = document.getElementById('upgradeSection');
    
    if (!textarea || !DEMO_VACATURES[type]) {
        showToast('Demo niet beschikbaar', 'Er ging iets mis bij het laden van de demo vacature.', 'error');
        return;
    }
    
    // Clear previous results
    if (resultsDiv) {
        resultsDiv.style.display = 'none';
    }
    if (upgradeSection) {
        upgradeSection.style.display = 'none';
    }
    
    // Load demo content with animation
    textarea.style.opacity = '0.5';
    
    setTimeout(() => {
        textarea.value = DEMO_VACATURES[type];
        updateCharCounter();
        textarea.style.opacity = '1';
        
        // Scroll to textarea
        textarea.scrollIntoView({ 
            behavior: 'smooth',
            block: 'center'
        });
        
        // Show success message
        const typeLabels = {
            slecht: 'Slechte Vacature',
            gemiddeld: 'Gemiddelde Vacature',
            goed: 'Goede Vacature'
        };
        
        showToast(
            `${typeLabels[type]} Geladen`,
            'Demo vacature is ingeladen. Klik op "Analyseer Vacature" om te beginnen.',
            'success'
        );
        
        // Track demo usage
        trackEvent('demo_loaded', {
            event_category: 'demo_usage',
            demo_type: type,
            text_length: textarea.value.length
        });
        
    }, 300);
}

// ===============================================
// TEXT PROCESSING FUNCTIONS
// ===============================================

function updateCharCounter() {
    const textarea = document.getElementById('vacatureInput');
    const charCountSpan = document.getElementById('charCount');
    const lengthIndicator = document.getElementById('lengthIndicator');
    const structureIndicator = document.getElementById('structureIndicator');
    const keywordIndicator = document.getElementById('keywordIndicator');
    
    if (!textarea || !charCountSpan) {
        console.warn('⚠️ updateCharCounter: Missing required elements', {
            textarea: !!textarea,
            charCountSpan: !!charCountSpan
        });
        return;
    }
    
    const text = textarea.value;
    const charCount = text.length;
    
    // Update character counter
    charCountSpan.textContent = charCount;
    
    // Update length indicator
    if (lengthIndicator) {
        let lengthStatus = '';
        let lengthClass = '';
        
        if (charCount < 100) {
            lengthStatus = 'Te kort';
            lengthClass = 'status-poor';
        } else if (charCount < 300) {
            lengthStatus = 'Kort';
            lengthClass = 'status-fair';
        } else if (charCount < 1000) {
            lengthStatus = 'Goed';
            lengthClass = 'status-good';
        } else if (charCount < 2000) {
            lengthStatus = 'Uitgebreid';
            lengthClass = 'status-excellent';
        } else {
            lengthStatus = 'Zeer uitgebreid';
            lengthClass = 'status-excellent';
        }
        
        lengthIndicator.innerHTML = `
            <span class="indicator-icon">📏</span>
            <span class="indicator-text ${lengthClass}">Lengte: ${lengthStatus}</span>
        `;
    }
    
    // Update structure indicator
    if (structureIndicator && text.length > 50) {
        const hasTitle = /^[A-Z][^\n]{10,}$/m.test(text);
        const hasBullets = /[•·\-\*]/.test(text);
        const hasSections = text.split('\n\n').length > 2;
        
        let structureScore = 0;
        if (hasTitle) structureScore++;
        if (hasBullets) structureScore++;
        if (hasSections) structureScore++;
        
        let structureStatus = '';
        let structureClass = '';
        
        if (structureScore >= 2) {
            structureStatus = 'Goed gestructureerd';
            structureClass = 'status-good';
        } else if (structureScore === 1) {
            structureStatus = 'Basic structuur';
            structureClass = 'status-fair';
        } else {
            structureStatus = 'Meer structuur nodig';
            structureClass = 'status-poor';
        }
        
        structureIndicator.innerHTML = `
            <span class="indicator-icon">🏗️</span>
            <span class="indicator-text ${structureClass}">Structuur: ${structureStatus}</span>
        `;
    }
    
    // Update keyword indicator
    if (keywordIndicator && text.length > 50) {
        const keywords = [
            'salaris', 'euro', '€', 'loon', 'beloning',
            'ervaring', 'jaar', 'senior', 'junior',
            'opleiding', 'hbo', 'wo', 'diploma',
            'team', 'collega', 'samenwerk',
            'groei', 'ontwikkel', 'carri[eë]re',
            'hybride', 'thuiswerk', 'kantoor',
            'sollicit', 'cv', 'motivatie'
        ];
        
        const textLower = text.toLowerCase();
        const foundKeywords = keywords.filter(keyword => 
            new RegExp(keyword).test(textLower)
        ).length;
        
        let keywordStatus = '';
        let keywordClass = '';
        
        if (foundKeywords >= 8) {
            keywordStatus = 'Rijk aan keywords';
            keywordClass = 'status-excellent';
        } else if (foundKeywords >= 5) {
            keywordStatus = 'Goede keywords';
            keywordClass = 'status-good';
        } else if (foundKeywords >= 3) {
            keywordStatus = 'Basic keywords';
            keywordClass = 'status-fair';
        } else {
            keywordStatus = 'Meer keywords nodig';
            keywordClass = 'status-poor';
        }
        
        keywordIndicator.innerHTML = `
            <span class="indicator-icon">🔑</span>
            <span class="indicator-text ${keywordClass}">Keywords: ${keywordStatus}</span>
        `;
    }
}

function clearInput() {
    const textarea = document.getElementById('vacatureInput');
    const resultsDiv = document.getElementById('results');
    const upgradeSection = document.getElementById('upgradeSection');
    
    if (textarea) {
        textarea.value = '';
        updateCharCounter();
        textarea.focus();
    }
    
    if (resultsDiv) {
        resultsDiv.style.display = 'none';
    }
    
    if (upgradeSection) {
        upgradeSection.style.display = 'none';
    }
    
    showToast('Input Gewist', 'Tekstveld is leeggemaakt.', 'info');
    
    trackEvent('input_cleared', {
        event_category: 'user_interaction'
    });
}

async function pasteFromClipboard() {
    try {
        const text = await navigator.clipboard.readText();
        const textarea = document.getElementById('vacatureInput');
        
        if (textarea && text.trim()) {
            textarea.value = text;
            updateCharCounter();
            textarea.focus();
            
            showToast('Tekst Geplakt', `${text.length} karakters geplakt uit klembord.`, 'success');
            
            trackEvent('clipboard_paste', {
                event_category: 'user_interaction',
                text_length: text.length
            });
        }
    } catch (error) {
        showToast('Plakken Mislukt', 'Kon niet plakken uit klembord. Gebruik Ctrl+V.', 'warning');
    }
}

function handlePaste(event) {
    setTimeout(() => {
        updateCharCounter();
        
        trackEvent('paste_event', {
            event_category: 'user_interaction',
            text_length: event.target.value.length
        });
    }, 100);
}

// ===============================================
// MAIN ANALYSIS FUNCTION
// ===============================================

async function analyzeVacature() {
    console.log('🎯 analyzeVacature function called');
    
    const textarea = document.getElementById('vacatureInput');
    const vacatureText = textarea ? textarea.value.trim() : '';
    
    console.log('📝 Input validation:', {
        textarea: !!textarea,
        textLength: vacatureText.length,
        hasText: !!vacatureText
    });
    
    // Enhanced Input Validation
    if (!vacatureText) {
        console.log('⚠️ No text provided');
        showToast('Geen Tekst', 'Voer eerst een vacaturetekst in om te analyseren.', 'warning');
        if (textarea) textarea.focus();
        return;
    }
    
    if (vacatureText.length < 50) {
        showToast('Tekst Te Kort', 'Voer minimaal 50 karakters in voor een betrouwbare analyse.', 'warning');
        return;
    }
    
    if (vacatureText.length > 8000) {
        showToast('Tekst Te Lang', 'Maximaal 8000 karakters toegestaan. Verkort je tekst.', 'warning');
        return;
    }
    
    // Sanitize input - remove potentially harmful content
    const sanitizedText = sanitizeVacatureInput(vacatureText);
    if (sanitizedText !== vacatureText) {
        console.warn('Input was sanitized - removed potentially harmful content');
    }
    
    // Enhanced race condition prevention
    if (isAnalyzing || currentAnalysisPromise) {
        showToast('Analyse Bezig', 'Er wordt al een analyse uitgevoerd. Even geduld...', 'info');
        return currentAnalysisPromise; // Return existing promise
    }
    
    // Create and store promise for race condition protection
    currentAnalysisPromise = (async () => {
        try {
            isAnalyzing = true;
            showLoading();
            
            // Track analysis start
            trackEvent('analysis_started', {
                event_category: 'analysis',
                text_length: sanitizedText.length,
                timestamp: new Date().toISOString()
            });
            
            console.log('🔍 Starting vacature analysis...');
            const startTime = Date.now();
            
            // Call Claude API with sanitized text
            const analysis = await callClaudeAPI(sanitizedText);
        
        const analysisTime = (Date.now() - startTime) / 1000;
        console.log(`✅ Analysis completed in ${analysisTime.toFixed(1)}s`);
        
            // Store analysis result
            currentAnalysis = analysis;
            displayResults(analysis);
            
            // Show upgrade section after analysis
            const upgradeSection = document.getElementById('upgradeSection');
            if (upgradeSection) {
                upgradeSection.style.display = 'block';
                upgradeSection.scrollIntoView({ behavior: 'smooth' });
            }
            
            // Track successful analysis
            trackEvent('analysis_completed', {
                event_category: 'analysis',
                score: analysis.gemiddelde_score,
                completion_time: analysisTime,
                text_length: sanitizedText.length
            });
            
            showToast(
                'Analyse Voltooid!', 
                `Score: ${analysis.gemiddelde_score}/10 - Bekijk de resultaten hieronder.`, 
                'success'
            );
            
            return analysis;
            
        } catch (error) {
            console.error('❌ Analysis failed:', error);
            showError(error.message);
            
            trackEvent('analysis_error', {
                event_category: 'analysis',
                error_message: error.message,
                text_length: sanitizedText.length
            });
            
            throw error; // Re-throw for promise handling
            
        } finally {
            isAnalyzing = false;
            currentAnalysisPromise = null; // Clear promise reference
            hideLoading();
        }
    })();
    
    return currentAnalysisPromise;
}

// ===============================================
// API INTEGRATION
// ===============================================

async function callClaudeAPI(vacatureText) {
    const prompt = NEDERLANDS_RECRUITMENT_PROMPT.replace('{VACATURE_TEKST}', vacatureText);
    
    try {
        console.log('🔍 Calling Claude API via Netlify function...');
        
        // Create abort controller for timeout
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout
        
        try {
            // Call Netlify function with timeout
            const response = await fetch('/.netlify/functions/claude-analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    prompt: prompt,
                    max_tokens: 4000
                }),
                signal: controller.signal
            });
            
            clearTimeout(timeoutId);
            return await processAPIResponse(response);
            
        } catch (error) {
            clearTimeout(timeoutId);
            if (error.name === 'AbortError') {
                throw new Error('API call timeout - probeer het opnieuw');
            }
            throw error;
        }
        
    } catch (error) {
        console.error('Claude API Error:', error);
        
        // Enhanced fallback with specific error handling
        return createFallbackAnalysis(vacatureText, error.message);
    }
}

async function processAPIResponse(response) {
    if (!response.ok) {
        const errorData = await response.json().catch(() => ({}));
        throw new Error(errorData.error || `API call failed: ${response.status} ${response.statusText}`);
    }

    const data = await response.json();
    
    if (!data.content || !data.content[0] || !data.content[0].text) {
        throw new Error('Invalid API response format');
    }
    
    let content = data.content[0].text;
    
    // Clean up JSON response
    content = content.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
    
    // Parse JSON with proper error handling
    let analysis;
    try {
        analysis = JSON.parse(content);
    } catch (parseError) {
        console.error('❌ JSON parsing failed:', parseError);
        throw new Error(`Invalid JSON response from AI: ${parseError.message}`);
    }
    
    // Validate required fields
    validateAnalysisResponse(analysis);
    
    console.log('✅ Claude API analysis successful');
    return analysis;
}

function createFallbackAnalysis(vacatureText, errorMessage) {
    // Enhanced fallback with specific error types
    if (errorMessage.includes('404') || errorMessage.includes('Netlify') || 
        errorMessage.includes('Failed to fetch') || errorMessage.includes('timeout') ||
        window.location.hostname === '127.0.0.1') {
        console.log('🔄 Using fallback mock analysis (development/offline mode)...');
        console.log('Error was:', errorMessage);
        
        return generateMockAnalysis(vacatureText);
    }
    
    // Re-throw other errors to show user
    throw new Error(`Analyse mislukt: ${errorMessage}. Probeer het opnieuw.`);
}

function validateAnalysisResponse(analysis) {
    const required = ['scores', 'gemiddelde_score', 'top_3_verbeterpunten', 'nederlandse_markt_analyse', 'geoptimaliseerde_versie'];
    
    for (const field of required) {
        if (!analysis[field]) {
            throw new Error(`Invalid analysis response: missing ${field}`);
        }
    }
    
    if (!analysis.scores.aantrekkelijkheid || !analysis.scores.duidelijkheid) {
        throw new Error('Invalid analysis response: missing score details');
    }
}

function generateMockAnalysis(vacatureText) {
    // Advanced mock analysis for demo purposes
    const textLength = vacatureText.length;
    const text = vacatureText.toLowerCase();
    
    // Analyze content for scoring
    const hasSalary = /€|euro|salaris|loon|\d+\.\d+|\d+k/i.test(vacatureText);
    const hasStructure = vacatureText.split('\n\n').length > 2;
    const hasBullets = /[•·\-\*]/.test(vacatureText);
    const hasContact = /email|mail|tel|telefoon|sollicit|cv/i.test(vacatureText);
    const hasLocation = /amsterdam|rotterdam|utrecht|eindhoven|den haag|gelderland|veluwe|arnhem|nijmegen|apeldoorn/i.test(vacatureText);
    const hasExperience = /ervaring|jaar|senior|junior|medior/i.test(vacatureText);
    const hasEducation = /hbo|wo|bachelor|master|opleiding|diploma/i.test(vacatureText);
    const hasBenefits = /vakantie|pensioen|ontwikkel|groei|hybride|thuiswerk|flexibel/i.test(vacatureText);
    
    // Calculate dynamic scores
    let aantrekkelijkheidsScore = 4;
    if (hasBenefits) aantrekkelijkheidsScore += 2;
    if (hasLocation) aantrekkelijkheidsScore += 1;
    if (textLength > 800) aantrekkelijkheidsScore += 1;
    aantrekkelijkheidsScore = Math.min(aantrekkelijkheidsScore, 9);
    
    let duidelijkheidScore = 5;
    if (hasStructure) duidelijkheidScore += 1;
    if (hasBullets) duidelijkheidScore += 1;
    if (hasExperience && hasEducation) duidelijkheidScore += 1;
    duidelijkheidScore = Math.min(duidelijkheidScore, 9);
    
    let volledigheidsScore = 4;
    if (hasContact) volledigheidsScore += 1;
    if (hasLocation) volledigheidsScore += 1;
    if (hasSalary) volledigheidsScore += 2;
    if (hasExperience) volledigheidsScore += 1;
    volledigheidsScore = Math.min(volledigheidsScore, 10);
    
    const salarisScore = hasSalary ? 8 : 2;
    const contactScore = hasContact ? 8 : 4;
    
    const gemiddeldeScore = ((aantrekkelijkheidsScore + duidelijkheidScore + volledigheidsScore + salarisScore + contactScore) / 5).toFixed(1);
    
    // Generate contextual feedback
    const verbeterpunten = [];
    if (!hasSalary) {
        verbeterpunten.push("Voeg een concrete salaris range toe (bijv. €45.000-65.000) - dit verhoogt respons met 40-60%");
    } else {
        verbeterpunten.push("Maak het salaris nog transparanter met volledige package details inclusief bonus en benefits");
    }
    
    if (aantrekkelijkheidsScore < 7) {
        verbeterpunten.push("Versterk employer branding met bedrijfscultuur, groeimogelijkheden en unieke benefits");
    }
    
    if (!hasStructure || !hasBullets) {
        verbeterpunten.push("Verbeter de structuur met duidelijke secties: 'Wat ga je doen', 'Wat zoeken we', 'Wat bieden wij'");
    }
    
    if (duidelijkheidScore < 7) {
        verbeterpunten.push("Maak taken en verantwoordelijkheden specifieker met concrete voorbeelden en verwachtingen");
    }
    
    if (!hasContact) {
        verbeterpunten.push("Voeg directe contactgegevens toe met naam recruiter en snelle reactietijd (binnen 24-48u)");
    }
    
    // Take top 3
    const top3Verbeterpunten = verbeterpunten.slice(0, 3);
    
    // Determine function level and salary
    const isSnior = text.includes('senior') || textLength > 1000;
    const functieniveau = isSnior ? "Senior niveau op basis van complexiteit en verantwoordelijkheden" : "Medior niveau op basis van beschrijving en eisen";
    const salarisRange = isSnior ? "€55.000-€75.000" : "€40.000-€60.000";
    
    return {
        scores: {
            aantrekkelijkheid: {
                score: aantrekkelijkheidsScore,
                toelichting: aantrekkelijkheidsScore >= 7 ? "Goede employer branding met aantrekkelijke benefits" : "Basis informatie aanwezig, maar meer aantrekkelijkheid nodig voor topkandidaten"
            },
            duidelijkheid: {
                score: duidelijkheidScore,
                toelichting: duidelijkheidScore >= 7 ? "Heldere functieomschrijving met goede structuur" : "Functieomschrijving kan specifieker en beter gestructureerd"
            },
            volledigheid: {
                score: volledigheidsScore,
                toelichting: volledigheidsScore >= 8 ? "Alle essentiële informatie compleet aanwezig" : "Enkele belangrijke elementen ontbreken voor complete vacature"
            },
            salaris_transparantie: {
                score: salarisScore,
                toelichting: hasSalary ? "Salarisinformatie aanwezig - groot voordeel voor respons" : "Geen salarisinformatie - dit verlaagt sollicitaties met 40-60%"
            },
            contact_sollicitatie: {
                score: contactScore,
                toelichting: hasContact ? "Contactinformatie en sollicitatieprocedure duidelijk" : "Sollicitatieprocedure en contactgegevens kunnen veel directer en persoonlijker"
            }
        },
        gemiddelde_score: Number(gemiddeldeScore),
        top_3_verbeterpunten: top3Verbeterpunten,
        nederlandse_markt_analyse: {
            functieniveau: functieniveau,
            salaris_inschatting: `${salarisRange} op basis van Nederlandse benchmarks voor vergelijkbare functies`,
            competitiviteit: gemiddeldeScore >= 7.5 ? "Sterk - zeer competitieve vacature die topkandidaten aantrekt" : 
                            gemiddeldeScore >= 6 ? "Gemiddeld - kan zich onderscheiden met verbeteringen" : 
                            "Zwak - significante verbeteringen nodig om te concurreren",
            tth_prognose: `${Math.max(25, Math.round(70 - (gemiddeldeScore * 6)))} dagen op basis van vacaturekwaliteit en marktomstandigheden`,
            regio_advies: "Voor Nederlandse markt: benadruk werk-privé balans, hybride werken en persoonlijke ontwikkeling"
        },
        geoptimaliseerde_versie: generateOptimizedVersion(vacatureText, hasSalary, isSnior)
    };
}

function generateOptimizedVersion(originalText, hasSalary, isSenior) {
    // Extract job title if possible
    const lines = originalText.split('\n');
    const possibleTitle = lines.find(line => line.trim().length > 5 && line.trim().length < 80) || "Functietitel";
    
    const salarRange = isSenior ? "€55.000 - €75.000" : "€45.000 - €65.000";
    const experienceLevel = isSenior ? "5+" : "3+";
    
    return `${possibleTitle}
${salarRange} | Hybride werken | Nederland

🚀 Sluit je aan bij ons innovatieve team!

Als ${possibleTitle.toLowerCase()} bij ons vooruitstrevende bedrijf werk je aan uitdagende projecten die er echt toe doen. Je krijgt de vrijheid om te groeien in een stimulerende omgeving.

💼 Wat ga je doen:
• Leiden van complexe projecten met directe impact
• Samenwerken met een gedreven multidisciplinair team  
• Ontwikkelen van innovatieve oplossingen voor echte uitdagingen
• Mentoring van junior collega's en kennisdeling
• Bijdragen aan strategische beslissingen

🎯 Wat zoeken wij:
• ${experienceLevel} jaar relevante werkervaring
• HBO/WO opleiding of gelijkwaardige ervaring
• Sterke analytische en communicatieve vaardigheden
• Proactieve houding en resultaatgericht denken
• Affiniteit met nieuwe technologieën en trends

💰 Wat bieden wij:
• Competitief salaris: ${salarRange} (incl. bonusregeling)
• Hybride werken: 3 dagen kantoor, 2 dagen thuis
• 27 vakantiedagen + 13 ADV dagen
• Persoonlijk ontwikkelbudget €2.500/jaar
• Moderne pensioenregeling met werkgeversbijdrage
• NS Business Card of lease(a)bike regeling
• Gezellig team met regular borrels en teamuitjes

🚀 Groeimogelijkheden:
• Duidelijk carrièrepad naar leidinggevende posities
• Internationale projecten en uitwisselingen
• Certificeringen en opleidingen volledig vergoed
• Interne mobiliteit naar andere afdelingen

📞 Direct solliciteren:
Enthousiast geworden? Solliciteer vandaag nog!

Email: recruitment@bedrijf.nl
Tel: 06-12345678 (ook WhatsApp)

✅ We reageren binnen 24 uur op je sollicitatie
✅ Informeel kennismakingsgesprek mogelijk
✅ Snelle procedure: van sollicitatie naar contract in 2 weken

Bedrijf BV | Locatie | www.bedrijf.nl
Acquisitie naar aanleiding van deze vacature wordt niet op prijs gesteld.`;
}

// ===============================================
// RESULTS DISPLAY
// ===============================================

function displayResults(analysis) {
    const resultsDiv = document.getElementById('results');
    if (!resultsDiv) return;
    
    // Generate scores HTML
    const scoresHTML = Object.entries(analysis.scores).map(([key, data]) => {
        const scoreClass = data.score <= 4 ? 'score-low' : data.score <= 6 ? 'score-medium' : 'score-high';
        const labels = {
            'aantrekkelijkheid': 'Aantrekkelijkheid',
            'duidelijkheid': 'Duidelijkheid', 
            'volledigheid': 'Volledigheid',
            'salaris_transparantie': 'Salaris Transparantie',
            'contact_sollicitatie': 'Contact/Sollicitatie'
        };
        
        return `
            <div class="score-card">
                <div class="score-number ${scoreClass}">${data.score}/10</div>
                <div class="score-label">${labels[key]}</div>
                <div class="score-description">${data.toelichting}</div>
            </div>
        `;
    }).join('');

    // Add average score
    const avgScoreClass = analysis.gemiddelde_score <= 4 ? 'score-low' : 
                         analysis.gemiddelde_score <= 6 ? 'score-medium' : 'score-high';
    
    const averageScoreHTML = `
        <div class="score-card average-score-card">
            <div class="score-number" style="color: var(--primary-orange);">${analysis.gemiddelde_score}/10</div>
            <div class="score-label"><strong>Gemiddelde Score</strong></div>
            <div class="score-description">
                ${analysis.gemiddelde_score >= 8 ? 'Uitstekende vacature!' : 
                  analysis.gemiddelde_score >= 6 ? 'Goede basis, nog te verbeteren' :
                  analysis.gemiddelde_score >= 4 ? 'Gemiddeld, aanzienlijke verbeteringen mogelijk' :
                  'Veel verbeteringen nodig voor betere resultaten'}
            </div>
        </div>
    `;

    // Generate improvements HTML
    const improvementsHTML = analysis.top_3_verbeterpunten.map((punt, index) => 
        `<li class="improvement-item">
            <span class="improvement-number">${index + 1}.</span> ${punt}
        </li>`
    ).join('');

    // Generate market analysis HTML
    const marketAnalysisHTML = `
        <div class="market-grid">
            <div class="market-item">
                <div class="market-label">Functieniveau:</div>
                <div class="market-value">${analysis.nederlandse_markt_analyse.functieniveau}</div>
            </div>
            <div class="market-item">
                <div class="market-label">Salaris inschatting:</div>
                <div class="market-value">${analysis.nederlandse_markt_analyse.salaris_inschatting}</div>
            </div>
            <div class="market-item">
                <div class="market-label">Competitiviteit:</div>
                <div class="market-value">${analysis.nederlandse_markt_analyse.competitiviteit}</div>
            </div>
            <div class="market-item">
                <div class="market-label">TTH prognose:</div>
                <div class="market-value">${analysis.nederlandse_markt_analyse.tth_prognose}</div>
            </div>
            ${analysis.nederlandse_markt_analyse.regio_advies ? 
              `<div class="market-item">
                <div class="market-label">Regio advies:</div>
                <div class="market-value">${analysis.nederlandse_markt_analyse.regio_advies}</div>
              </div>` : ''
            }
        </div>
    `;

    // Full results HTML
    const resultsHTML = `
        <div class="results-header">
            <h3 class="results-title">📊 Vacature Analyse Resultaten</h3>
            <p class="results-subtitle">
                Gebaseerd op Nederlandse recruitment best practices en marktstandaarden
            </p>
        </div>
        
        <div class="scores-grid">
            ${scoresHTML}
            ${averageScoreHTML}
        </div>
        
        <div class="analysis-section">
            <h4 class="analysis-title">
                <span>🎯</span>
                Top 3 Kritieke Verbeterpunten
            </h4>
            <ul class="improvement-list">
                ${improvementsHTML}
            </ul>
        </div>
        
        <div class="analysis-section">
            <h4 class="analysis-title">
                <span>💰</span>
                Nederlandse Marktanalyse
            </h4>
            <div class="market-analysis">
                ${marketAnalysisHTML}
            </div>
        </div>
        
        <!-- HIDDEN: Optimized section kept for follow-up emails -->
        <div class="optimized-section" style="display: none;" data-feature="follow-up-email">
            <h4 class="analysis-title">
                <span>⚡</span>
                Geoptimaliseerde Vacaturetekst
            </h4>
            <div class="optimized-text">${analysis.geoptimaliseerde_versie}</div>
            <button onclick="downloadAnalysis()" class="copy-btn" style="background: var(--primary-blue);">
                <span>📄</span>
                Download Volledige Analyse (PDF)
            </button>
        </div>
    `;

    resultsDiv.innerHTML = resultsHTML;
    resultsDiv.style.display = 'block';
    
    // Smooth scroll to results
    setTimeout(() => {
        resultsDiv.scrollIntoView({ 
            behavior: 'smooth',
            block: 'start'
        });
    }, 100);
}

// ===============================================
// TYPEFORM INTEGRATION
// ===============================================

function showUpgradeSection() {
    const upgradeSection = document.getElementById('upgradeSection');
    if (upgradeSection) {
        upgradeSection.style.display = 'block';
        
        // Smooth scroll to the section after a delay
        setTimeout(() => {
            upgradeSection.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }, 1000);
        
        trackEvent('upgrade_section_shown', {
            event_category: 'conversion',
            analysis_score: currentAnalysis ? currentAnalysis.gemiddelde_score : 'unknown'
        });
    }
}

// Improved TypeForm Integration
function loadImprovedTypeForm() {
    const button = document.getElementById('loadTypeFormBtn');
    const loading = document.getElementById('typeformLoading');
    const embed = document.getElementById('typeformEmbed');
    
    // Track click
    trackEvent('typeform_clicked', {
        event_category: 'conversion',
        analysis_score: currentAnalysis ? currentAnalysis.gemiddelde_score : 'unknown'
    });
    
    // Show loading
    button.style.display = 'none';
    loading.style.display = 'block';
    
    // Load TypeForm script if not already loaded
    if (!document.querySelector('script[src*="embed.typeform.com"]')) {
        const script = document.createElement('script');
        script.src = '//embed.typeform.com/next/embed.js';
        script.onload = () => {
            console.log('✅ TypeForm script loaded');
            showTypeForm();
        };
        script.onerror = () => {
            console.error('❌ TypeForm script failed to load');
            fallbackToDirectLink();
        };
        document.head.appendChild(script);
        
        // Timeout fallback
        setTimeout(() => {
            if (loading.style.display !== 'none') {
                fallbackToDirectLink();
            }
        }, 5000);
    } else {
        showTypeForm();
    }
    
    function showTypeForm() {
        loading.style.display = 'none';
        embed.style.display = 'block';
        
        // Scroll to form
        embed.scrollIntoView({ behavior: 'smooth', block: 'start' });
        
        showToast('TypeForm Geladen!', 'Upload je vacature document hieronder.', 'success');
    }
    
    function fallbackToDirectLink() {
        loading.style.display = 'none';
        
        // Create direct link
        const linkContainer = document.createElement('div');
        linkContainer.style.textAlign = 'center';
        linkContainer.style.padding = '2rem';
        linkContainer.style.background = 'white';
        linkContainer.style.borderRadius = '1rem';
        linkContainer.style.marginTop = '2rem';
        linkContainer.innerHTML = `
            <h4 style="margin-bottom: 1rem; color: #1f2937;">📄 Document Upload</h4>
            <p style="margin-bottom: 2rem; color: #6b7280;">
                Klik onderstaande link om het upload formulier te openen in een nieuw tabblad:
            </p>
            <a href="https://form.typeform.com/to/01K25SKWYTKZ05DAHER9D52J94" 
               target="_blank" 
               class="upgrade-btn"
               style="text-decoration: none;">
                <span>🚀</span>
                <span>Open Upload Formulier</span>
            </a>
        `;
        
        document.getElementById('typeformContainer').appendChild(linkContainer);
        showToast('Direct Link', 'TypeForm opent in een nieuw tabblad.', 'info');
    }
}

// ===============================================
// UI HELPER FUNCTIONS
// ===============================================

function showLoading() {
    const btn = document.getElementById('analyzeBtn');
    if (!btn) return;
    
    btn.disabled = true;
    btn.innerHTML = `
        <div class="spinner"></div>
        <div>
            <div class="btn-text">Analyseren...</div>
            <div class="btn-subtitle">Claude AI werkt voor je</div>
        </div>
    `;
    
    document.getElementById('results').style.display = 'none';
}

function hideLoading() {
    const btn = document.getElementById('analyzeBtn');
    if (!btn) return;
    
    btn.disabled = false;
    btn.innerHTML = `
        <span class="btn-icon">🚀</span>
        <span class="btn-text">Analyseer Vacature</span>
        <span class="btn-subtitle">AI-powered Nederlandse analyse</span>
    `;
}

function showError(message) {
    const resultsDiv = document.getElementById('results');
    if (!resultsDiv) return;
    
    resultsDiv.style.display = 'block';
    resultsDiv.innerHTML = `
        <div class="error-section">
            <h3 class="error-title">❌ Analyse Mislukt</h3>
            <p class="error-message">${message}</p>
            <p><strong>Mogelijke oplossingen:</strong></p>
            <ul style="text-align: left; margin: 1rem 0;">
                <li>Controleer je internetverbinding</li>
                <li>Probeer het over een paar minuten opnieuw</li>
                <li>Gebruik een kortere vacaturetekst</li>
                <li>Herlaad de pagina als het probleem aanhoudt</li>
            </ul>
            <button onclick="analyzeVacature()" class="retry-btn">
                🔄 Opnieuw Proberen
            </button>
        </div>
    `;
}

function showToast(title, message, type = 'info') {
    const container = document.getElementById('toastContainer');
    if (!container) return;
    
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    
    toast.innerHTML = `
        <div class="toast-title">${title}</div>
        <div class="toast-message">${message}</div>
    `;
    
    container.appendChild(toast);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        if (toast.parentNode) {
            toast.style.animation = 'slideOutRight 0.3s ease-out forwards';
            setTimeout(() => {
                if (toast.parentNode) {
                    container.removeChild(toast);
                }
            }, 300);
        }
    }, 5000);
}

// ===============================================
// UTILITY FUNCTIONS
// ===============================================

// ===============================================
// HIDDEN FEATURES - Kept for Follow-up Email CTA
// ===============================================
// Functions below are hidden from UI but kept in code for future email campaigns
// - downloadAnalysis() - PDF generation functionality 
// - generateOptimizedVersion() - Complete optimized vacancy text
// - All analysis data still generated and stored in currentAnalysis
// These can be activated by removing 'display: none' styles

// Copy function removed as requested - users can select text manually

async function downloadAnalysis() {
    if (!currentAnalysis) return;
    
    const button = event.target;
    const originalText = button.textContent;
    
    try {
        // Show loading state
        button.textContent = '📄 PDF Genereren...';
        button.disabled = true;
        
        showToast('PDF Genereren', 'Professioneel rapport wordt gegenereerd...', 'info');
        
        console.log('🔍 Generating PDF report with PDF Monkey...');
        
        // Get original vacature text
        const originalVacatureText = document.getElementById('vacatureInput').value;
        
        // Call PDF generation function with timeout
        const pdfController = new AbortController();
        const pdfTimeoutId = setTimeout(() => pdfController.abort(), 45000); // 45 second timeout
        
        const response = await fetch('/.netlify/functions/generate-pdf', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                analysisData: currentAnalysis,
                vacatureText: currentAnalysis.geoptimaliseerde_versie || '',
                originalText: originalVacatureText
            }),
            signal: pdfController.signal
        });
        
        clearTimeout(pdfTimeoutId);
        
        if (!response.ok) {
            throw new Error(`PDF generation failed: ${response.status}`);
        }
        
        // Check if response is JSON (PDF Monkey success) or text (fallback)
        const contentType = response.headers.get('content-type');
        
        if (contentType && contentType.includes('application/json')) {
            // PDF Monkey integration - get download URL
            const result = await response.json();
            
            if (result.success && result.download_url) {
                // Open PDF in new window
                window.open(result.download_url, '_blank');
                showToast('PDF Gereed', 'Professioneel rapport wordt gedownload!', 'success');
                
                trackEvent('pdf_downloaded', {
                    event_category: 'user_interaction',
                    score: currentAnalysis.gemiddelde_score,
                    method: 'pdfmonkey'
                });
            } else {
                // PDF is being generated, show status
                showToast('PDF Wordt Verwerkt', result.message || 'Even geduld...', 'info');
                
                // Poll for completion if document_id is provided
                if (result.document_id) {
                    checkPdfStatus(result.document_id);
                }
            }
        } else {
            // Fallback text download
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            
            link.href = url;
            link.download = `vacature-analyse-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
            
            showToast('Tekstrapport Gedownload', 'PDF niet beschikbaar, tekstversie gedownload.', 'warning');
            
            trackEvent('text_downloaded', {
                event_category: 'user_interaction',
                score: currentAnalysis.gemiddelde_score,
                method: 'fallback'
            });
        }
        
    } catch (error) {
        console.error('❌ Download error:', error);
        
        // Fallback to simple text download
        downloadTextReport();
        
        showToast('Download Fout', 'Tekstrapport als alternatief gedownload.', 'warning');
        
        trackEvent('download_error', {
            event_category: 'error',
            error_message: error.message
        });
    } finally {
        // Reset button state
        button.textContent = originalText;
        button.disabled = false;
    }
}

// Helper function for text fallback download
function downloadTextReport() {
    if (!currentAnalysis) return;
    
    const content = `
NEDERLANDSE VACATURE ANALYSE RAPPORT
=====================================

Datum: ${new Date().toLocaleDateString('nl-NL')}
Geanalyseerd met: TalentFlow Pro - Nederlandse Vacature Optimizer

SCORES OVERZICHT:
================
• Aantrekkelijkheid: ${currentAnalysis.scores.aantrekkelijkheid.score}/10
• Duidelijkheid: ${currentAnalysis.scores.duidelijkheid.score}/10
• Volledigheid: ${currentAnalysis.scores.volledigheid.score}/10
• Salaris Transparantie: ${currentAnalysis.scores.salaris_transparantie.score}/10
• Contact/Sollicitatie: ${currentAnalysis.scores.contact_sollicitatie.score}/10

GEMIDDELDE SCORE: ${currentAnalysis.gemiddelde_score}/10

TOP 3 VERBETERPUNTEN:
====================
1. ${currentAnalysis.top_3_verbeterpunten[0]}
2. ${currentAnalysis.top_3_verbeterpunten[1]}
3. ${currentAnalysis.top_3_verbeterpunten[2]}

NEDERLANDSE MARKTANALYSE:
========================
• Functieniveau: ${currentAnalysis.nederlandse_markt_analyse.functieniveau}
• Salaris inschatting: ${currentAnalysis.nederlandse_markt_analyse.salaris_inschatting}
• Competitiviteit: ${currentAnalysis.nederlandse_markt_analyse.competitiviteit}
• TTH prognose: ${currentAnalysis.nederlandse_markt_analyse.tth_prognose}

GEOPTIMALISEERDE VACATURETEKST:
==============================
${currentAnalysis.geoptimaliseerde_versie}

---
Gegenereerd door TalentFlow Pro
Nederlandse Recruitment Intelligence
    `;
    
    const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
    const url = window.URL.createObjectURL(blob);
    const link = document.createElement('a');
    
    link.href = url;
    link.download = `vacature-analyse-${new Date().toISOString().split('T')[0]}.txt`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    window.URL.revokeObjectURL(url);
}

// Helper function to check PDF generation status
async function checkPdfStatus(documentId, attempts = 0) {
    if (attempts > 10) {
        showToast('PDF Timeout', 'PDF generatie duurt langer dan verwacht.', 'warning');
        return;
    }
    
    try {
        // This would need PDF Monkey status API - for now just show completion
        setTimeout(() => {
            showToast('PDF Klaar', 'Check je downloads voor het rapport!', 'success');
        }, 3000);
        
    } catch (error) {
        console.error('PDF status check failed:', error);
    }
}

function trackEvent(eventName, parameters = {}) {
    // Google Analytics tracking
    if (typeof gtag !== 'undefined') {
        gtag('event', eventName, {
            event_category: parameters.event_category || 'general',
            ...parameters
        });
    }
    
    // Console logging for development
    console.log(`📊 Event: ${eventName}`, parameters);
}

// ===============================================
// EXPORT FOR TESTING
// ===============================================

// Make functions available globally for testing
window.TalentFlowOptimizer = {
    analyzeVacature,
    loadDemoVacature,
    downloadAnalysis,
    clearInput,
    pasteFromClipboard
};

// Initialize when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeApp);
} else {
    initializeApp();
}

console.log('🧪 JavaScript loading test - All functions declared successfully');
console.log('🇳🇱 Nederlandse Vacature Optimizer geladen - Ready for analysis!');

// Final syntax test
try {
    console.log('🧪 Final syntax test - SUCCESS');
} catch (error) {
    console.error('🧪 Final syntax test - ERROR:', error);
}

// ===============================================
// SIMPLIFIED UPLOAD NOTIFICATION SYSTEM
// ===============================================


// ===============================================
// PRIVACY CHECKBOX FUNCTIONALITY
// ===============================================

function initializePrivacyCheckbox() {
    const checkbox = document.getElementById('privacyAcceptance');
    const button = document.getElementById('openTypeFormBtn');
    
    if (!checkbox || !button) {
        console.warn('Privacy checkbox or upload button not found');
        return;
    }
    
    // Initial state - button disabled
    updateUploadButtonState();
    
    // Listen for checkbox changes
    checkbox.addEventListener('change', updateUploadButtonState);
    
    function updateUploadButtonState() {
        if (checkbox.checked) {
            // Enable button
            button.disabled = false;
            button.style.opacity = '1';
            button.style.cursor = 'pointer';
            button.style.transform = 'scale(1)';
            button.style.transition = 'all 0.3s ease';
            
            console.log('✅ Privacy accepted - Upload button enabled');
            
            trackEvent('privacy_accepted', {
                event_category: 'privacy',
                timestamp: new Date().toISOString()
            });
        } else {
            // Disable button
            button.disabled = true;
            button.style.opacity = '0.5';
            button.style.cursor = 'not-allowed';
            button.style.transform = 'scale(0.98)';
            
            console.log('❌ Privacy not accepted - Upload button disabled');
        }
    }
}

// Open TypeForm in popup with privacy check
function openTypeForm() {
    const checkbox = document.getElementById('privacyAcceptance');
    
    // Double check privacy acceptance
    if (!checkbox || !checkbox.checked) {
        showToast('Privacy Vereist', 'Accepteer eerst de privacyverklaring om door te gaan.', 'warning');
        
        // Highlight the checkbox
        const checkboxContainer = checkbox?.parentElement.parentElement;
        if (checkboxContainer) {
            checkboxContainer.style.border = '2px solid #dc3545';
            checkboxContainer.style.background = '#fff5f5';
            
            setTimeout(() => {
                checkboxContainer.style.border = '1px solid #e9ecef';
                checkboxContainer.style.background = '#f8f9fa';
            }, 3000);
        }
        
        trackEvent('privacy_warning_shown', {
            event_category: 'privacy'
        });
        
        return;
    }
    
    // Track click
    trackEvent('typeform_popup_clicked', {
        event_category: 'conversion',
        analysis_score: currentAnalysis ? currentAnalysis.gemiddelde_score : 'unknown',
        privacy_accepted: true
    });
    
    console.log('🚀 Opening TypeForm in popup...');
    
    // Use TypeForm's popup API if available
    if (typeformScriptLoaded && window.tf && window.tf.load) {
        window.tf.load('01K25SKWYTKZ05DAHER9D52J94', {
            popup: true,
            hideHeaders: true,
            hideFooter: true,
            opacity: 100,
            onSubmit: function() {
                console.log('✅ TypeForm submitted successfully');
                handleTypeFormCompletion();
            },
            onClose: function() {
                console.log('TypeForm closed by user');
                trackEvent('typeform_popup_closed', {
                    event_category: 'conversion'
                });
            }
        });
        
        trackEvent('typeform_popup_opened', {
            event_category: 'conversion',
            method: 'popup_api'
        });
    } else {
        // Fallback: Open in new tab/window
        const formUrl = 'https://form.typeform.com/to/01K25SKWYTKZ05DAHER9D52J94';
        const popup = window.open(formUrl, 'typeform_popup', 'width=800,height=700,scrollbars=yes,resizable=yes,centerscreen=yes');
        
        if (popup) {
            showToast('Formulier Geopend', 'Het upload formulier is geopend in een nieuw venster.', 'success');
            
            // Monitor for popup close (basic detection)
            const checkClosed = setInterval(() => {
                if (popup.closed) {
                    clearInterval(checkClosed);
                    console.log('TypeForm popup was closed');
                    
                    // Show completion dialog after delay (assuming form was submitted)
                    setTimeout(() => {
                        if (confirm('Heb je het formulier succesvol ingevuld en verzonden?')) {
                            handleTypeFormCompletion();
                        }
                    }, 1000);
                }
            }, 1000);
            
            trackEvent('typeform_popup_opened', {
                event_category: 'conversion',
                method: 'new_window'
            });
        } else {
            // Popup blocked, show direct link
            showToast('Popup Geblokkeerd', 'Popup werd geblokkeerd. Klik hieronder om het formulier te openen.', 'warning');
            showDirectLink();
        }
    }
}

// Handle TypeForm completion
function handleTypeFormCompletion() {
    const buttonContainer = document.getElementById('typeformButtonContainer');
    const successMessage = document.getElementById('typeformSuccessMessage');
    
    // Hide button and show success message
    buttonContainer.style.display = 'none';
    successMessage.style.display = 'block';
    
    // Smooth fade in animation
    successMessage.style.opacity = '0';
    successMessage.style.transform = 'translateY(20px)';
    successMessage.style.transition = 'all 0.5s ease';
    
    setTimeout(() => {
        successMessage.style.opacity = '1';
        successMessage.style.transform = 'translateY(0)';
        successMessage.scrollIntoView({ behavior: 'smooth' });
    }, 100);
    
    // Show toast notification
    showToast('Formulier Verzonden!', 'Je upload is succesvol ontvangen. Check je email binnen 24 uur.', 'success');
    
    trackEvent('typeform_completed', {
        event_category: 'conversion',
        event_label: 'form_submitted'
    });
}

// Show direct link fallback
function showDirectLink() {
    const buttonContainer = document.getElementById('typeformButtonContainer');
    
    // Add direct link below button
    const linkElement = document.createElement('div');
    linkElement.style.textAlign = 'center';
    linkElement.style.marginTop = '1rem';
    linkElement.style.padding = '1rem';
    linkElement.style.background = '#f8f9fa';
    linkElement.style.borderRadius = '0.5rem';
    linkElement.innerHTML = `
        <p style="margin: 0 0 1rem 0; color: #6b7280;">Popup werd geblokkeerd? Gebruik deze directe link:</p>
        <a href="https://form.typeform.com/to/01K25SKWYTKZ05DAHER9D52J94" target="_blank" style="
            display: inline-block;
            background: #FF6B35;
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        ">🚀 Open Upload Formulier</a>
    `;
    
    buttonContainer.appendChild(linkElement);
}

    </script>
</body>
</html>